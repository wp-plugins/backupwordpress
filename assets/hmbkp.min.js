function hmbkpToggleScheduleFields(a){a="undefined"!=typeof a?a:"manually";var b=jQuery(".recurring-setting"),c=jQuery("#schedule-start"),d=jQuery("p.twice-js");switch(a){case"manually":b.hide();break;case"hmbkp_hourly":case"hmbkp_daily":b.hide(),c.show(),d.hide();break;case"hmbkp_twicedaily":b.hide(),c.show(),d.show();break;case"hmbkp_weekly":case"hmbkp_fortnightly":b.hide(),jQuery("#start-day").show(),c.show(),d.hide();break;case"hmbkp_monthly":b.hide(),c.show(),jQuery("#start-date").show(),d.hide()}jQuery.colorbox.resize()}function hmbkpCatchResponseAndOfferToEmail(a){a&&0!=a?(jQuery(".hmbkp-schedule-sentence.hmbkp-running").removeClass("hmbkp-running").addClass("hmbkp-error"),jQuery.post(ajaxurl,{nonce:hmbkp.nonce,action:"hmbkp_backup_error",hmbkp_error:a},function(a){a&&0!=a&&jQuery.colorbox({innerWidth:"320px",maxHeight:"100%",html:a,overlayClose:!1,escKey:!1,onLoad:function(){jQuery("#cboxClose").remove(),jQuery.colorbox.resize()}})})):location.reload(!0),jQuery(document).one("click",".hmbkp_send_error_via_email",function(b){b.preventDefault(),jQuery(this).addClass("hmbkp-ajax-loading").attr("disabled","disabled"),jQuery.post(ajaxurl,{nonce:hmbkp.nonce,action:"hmbkp_email_error",hmbkp_error:a},function(){jQuery.colorbox.close()})})}jQuery(document).ready(function(a){a.ajaxSetup({cache:!1}),a(document).ajaxComplete(function(){a(".hmbkp-ajax-loading").removeClass("hmbkp-ajax-loading").removeAttr("disabled")}),a(document).on("click",".hmbkp-colorbox-close",function(){a.colorbox.close(),location.reload()}),a(".hmbkp-tabs").tabs(),a(".subsubsub a.current").size()||a(".subsubsub li:first a").addClass("current"),a(".colorbox").colorbox({initialWidth:"320px",initialHeight:"100px",transition:"elastic",scrolling:!1,innerWidth:"320px",maxHeight:"85%",escKey:!1,overlayClose:!1,onLoad:function(){a("#cboxClose").remove()},onComplete:function(){a(".hmbkp-tabs").tabs(),a(".hmbkp-form p.submit:contains('"+hmbkp.update+"')").size()&&a('<button type="button" class="button-secondary hmbkp-colorbox-close">'+hmbkp.cancel+"</button>").appendTo(".hmbkp-form p.submit"),a(".recurring-setting").hide(),hmbkpToggleScheduleFields(a("select#hmbkp_schedule_recurrence_type").val()),a(document).on("change","select#hmbkp_schedule_recurrence_type",function(){hmbkpToggleScheduleFields(a(this).val())}),a.colorbox.resize()}}),a(document).on("click",".ui-tabs-anchor",function(){a.colorbox.resize()}),a(document).on("click",".hmbkp-schedule-actions .delete-action",function(a){confirm(hmbkp.delete_schedule)||a.preventDefault()}),a(document).on("click",".hmbkp_manage_backups_row .delete-action",function(a){confirm(hmbkp.delete_backup)||a.preventDefault()}),a(document).on("click",".hmbkp-edit-schedule-excludes-form .delete-action",function(a){confirm(hmbkp.remove_exclude_rule)||a.preventDefault()}),a(document).on("click",".hmbkp_preview_exclude_rule",function(){return a(".hmbkp_add_exclude_rule input").val()?(a(this).addClass("hmbkp-ajax-loading").attr("disabled","disabled"),void a.post(ajaxurl,{nonce:hmbkp.nonce,action:"hmbkp_file_list",hmbkp_schedule_excludes:a(".hmbkp_add_exclude_rule input").val(),hmbkp_schedule_id:a('[name="hmbkp_schedule_id"]').val()},function(b){a(".hmbkp_add_exclude_rule ul").remove(),a(".hmbkp_add_exclude_rule p").remove(),a(".hmbkp_add_exclude_rule").append(-1!=b.indexOf("hmbkp_file_list")?b:"<p>There was an error previewing the exclude rule.</p>"),a(".hmbkp-edit-schedule-excludes-form").addClass("hmbkp-exclude-preview-open"),a.colorbox.resize()})):(a(".hmbkp_add_exclude_rule ul").remove(),void a(".hmbkp_add_exclude_rule p").remove())}),a(document).on("keypress",".hmbkp_add_exclude_rule input",function(b){if(!a(".hmbkp_add_exclude_rule input").val())return!0;var c=b.keyCode?b.keyCode:b.which;return 13!=c?!0:(a(".hmbkp_preview_exclude_rule").click(),void b.preventDefault())}),a(document).on("click",".hmbkp_cancel_save_exclude_rule, .hmbkp-edit-schedule-excludes-form .submit button",function(){a(".hmbkp_add_exclude_rule ul").remove(),a(".hmbkp_add_exclude_rule p").remove(),a(".hmbkp-edit-schedule-excludes-form").removeClass("hmbkp-exclude-preview-open"),a.colorbox.resize()}),a(document).on("click",".hmbkp_save_exclude_rule",function(){a(this).addClass("hmbkp-ajax-loading").attr("disabled","disabled"),a.post(ajaxurl,{nonce:hmbkp.nonce,action:"hmbkp_add_exclude_rule",hmbkp_exclude_rule:a(".hmbkp_add_exclude_rule input").val(),hmbkp_schedule_id:a('[name="hmbkp_schedule_id"]').val()},function(b){a(".hmbkp-edit-schedule-excludes-form").replaceWith(b),a(".hmbkp-edit-schedule-excludes-form").show(),a(".hmbkp-tabs").tabs(),a.colorbox.resize()})}),a(document).on("click",".hmbkp-edit-schedule-excludes-form td a",function(b){a(this).addClass("hmbkp-ajax-loading").text("").attr("disabled","disabled"),a.colorbox.resize(),b.preventDefault(),a.get(ajaxurl,{action:"hmbkp_delete_exclude_rule",hmbkp_exclude_rule:a(this).closest("td").attr("data-hmbkp-exclude-rule"),hmbkp_schedule_id:a('[name="hmbkp_schedule_id"]').val()},function(b){a(".hmbkp-edit-schedule-excludes-form").replaceWith(b),a(".hmbkp-edit-schedule-excludes-form").show(),a(".hmbkp-tabs").tabs(),a.colorbox.resize()})}),a(document).on("submit","form.hmbkp-form",function(b){var c=a(this).find('button[type="submit"]').hasClass("dest-settings-save"),d="add"==a(this).closest("form").attr("data-schedule-action")?!0:!1,e=a(this).closest("form").find('[name="hmbkp_schedule_id"]').val();if("undefined"!=typeof e){if(!d&&Number(a('input[name="hmbkp_schedule_max_backups"]').val())<Number(a(".hmbkp_manage_backups_row").size())&&!confirm(hmbkp.remove_old_backups))return!1;a(this).find('button[type="submit"]').addClass("hmbkp-ajax-loading").attr("disabled","disabled"),a(".hmbkp-error span").remove(),a(".hmbkp-error").removeClass("hmbkp-error"),b.preventDefault(),a.get(ajaxurl+"?"+a(this).serialize(),{action:"hmbkp_edit_schedule_submit"},function(b){if(b.success===!0&&c===!1)a.colorbox.close(),d?location.replace("//"+location.host+location.pathname+"?page="+hmbkp.page_slug+"&hmbkp_schedule_id="+e):location.reload();else if(b.success===!0);else{var f=b.data;a.each(f,function(b,c){var d=b.replace(/(:|\.|\[|\])/g,"\\$1");"undefined"==typeof hmbkp_focused&&(a("#"+d).focus(),hmbkp_focused=!0),a("label[for="+d+"]").addClass("hmbkp-error"),a("#"+d).next("span").remove(),a("#"+d).after('<span class="hmbkp-error">'+c+"</span>")})}})}}),a.post(ajaxurl,{nonce:hmbkp.nonce,action:"hmbkp_cron_test"},function(b){1!=b&&a(".wrap > h2").after(b)}),a(".hmbkp-schedule-sentence .calculating").size()&&a.post(ajaxurl,{nonce:hmbkp.nonce,action:"hmbkp_calculate",hmbkp_schedule_id:a("[data-hmbkp-schedule-id]").attr("data-hmbkp-schedule-id")},function(b){-1!=b.indexOf("title")?a(".hmbkp-schedule-sentence").replaceWith(b):a(".calculating").remove()}).error(function(){a(".calculating").remove()}),a(document).on("click",".hmbkp-run",function(b){a(this).closest(".hmbkp-schedule-sentence").addClass("hmbkp-running"),a(".hmbkp-error").removeClass("hmbkp-error"),scheduleId=a("[data-hmbkp-schedule-id]").attr("data-hmbkp-schedule-id"),ajaxRequest=a.post(ajaxurl,{nonce:hmbkp.nonce,action:"hmbkp_run_schedule",hmbkp_schedule_id:scheduleId}).done(function(a){hmbkpCatchResponseAndOfferToEmail(a)}).fail(function(a){hmbkpCatchResponseAndOfferToEmail(a.responseText)}),b.preventDefault()}),a(document).on("heartbeat-send",function(b,c){c.hmbkp_is_in_progress=a("[data-hmbkp-schedule-id]").attr("data-hmbkp-schedule-id")});var b=!1;a(document).on("heartbeat-tick",function(c,d){0!=d.hmbkp_schedule_status||1!=b||a(".hmbkp-error").size()||location.reload(!0),0!=d.hmbkp_schedule_status&&(b=!0,a(".hmbkp-status").remove(),a(".hmbkp-schedule-actions").replaceWith(d.hmbkp_schedule_status))})});